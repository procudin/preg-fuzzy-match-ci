!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){"use strict";function b(a,b){for(var c=a.length;--c;)if(Math.round(+a[c])!==Math.round(+b[c]))return!1;return!0}function c(b){var c={range:!0,animate:!0};return"boolean"==typeof b?c.animate=b:a.extend(c,b),c}function d(b,c,d,e,f,g,h,i,j){"array"===a.type(b)?this.elements=[+b[0],+b[2],+b[4],+b[1],+b[3],+b[5],0,0,1]:this.elements=[b,c,d,e,f,g,h||0,i||0,j||1]}function e(a,b,c){this.elements=[a,b,c]}function f(b,c){if(!(this instanceof f))return new f(b,c);1!==b.nodeType&&a.error("Panzoom called on non-Element node"),a.contains(g,b)||a.error("Panzoom element must be attached to the document");var d=a.data(b,h);if(d)return d;this.options=c=a.extend({},f.defaults,c),this.elem=b;var e=this.$elem=a(b);this.$set=c.$set&&c.$set.length?c.$set:e,this.$doc=a(b.ownerDocument||g),this.$parent=e.parent(),this.parent=this.$parent[0],this.isSVG=m.test(b.namespaceURI)&&"svg"!==b.nodeName.toLowerCase(),this.panning=!1,this._buildTransform(),this._transform=a.cssProps.transform.replace(l,"-$1").toLowerCase(),this._buildTransition(),this.resetDimensions();var i=a(),j=this;a.each(["$zoomIn","$zoomOut","$zoomRange","$reset"],function(a,b){j[b]=c[b]||i}),this.enable(),this.scale=this.getMatrix()[0],this._checkPanWhenZoomed(),a.data(b,h,this)}var g=window.document,h="__pz__",i=Array.prototype.slice,j=/trident\/7./i,k=function(){if(j.test(navigator.userAgent))return!1;var a=g.createElement("input");return a.setAttribute("oninput","return"),"function"==typeof a.oninput}(),l=/([A-Z])/g,m=/^http:[\w\.\/]+svg$/,n="(\\-?\\d[\\d\\.e-]*)",o="\\,?\\s*",p=new RegExp("^matrix\\("+n+o+n+o+n+o+n+o+n+o+n+"\\)$");return d.prototype={x:function(a){var b=a instanceof e,c=this.elements,f=a.elements;return b&&3===f.length?new e(c[0]*f[0]+c[1]*f[1]+c[2]*f[2],c[3]*f[0]+c[4]*f[1]+c[5]*f[2],c[6]*f[0]+c[7]*f[1]+c[8]*f[2]):f.length===c.length&&new d(c[0]*f[0]+c[1]*f[3]+c[2]*f[6],c[0]*f[1]+c[1]*f[4]+c[2]*f[7],c[0]*f[2]+c[1]*f[5]+c[2]*f[8],c[3]*f[0]+c[4]*f[3]+c[5]*f[6],c[3]*f[1]+c[4]*f[4]+c[5]*f[7],c[3]*f[2]+c[4]*f[5]+c[5]*f[8],c[6]*f[0]+c[7]*f[3]+c[8]*f[6],c[6]*f[1]+c[7]*f[4]+c[8]*f[7],c[6]*f[2]+c[7]*f[5]+c[8]*f[8])},inverse:function(){var a=1/this.determinant(),b=this.elements;return new d(a*(b[8]*b[4]-b[7]*b[5]),a*-(b[8]*b[1]-b[7]*b[2]),a*(b[5]*b[1]-b[4]*b[2]),a*-(b[8]*b[3]-b[6]*b[5]),a*(b[8]*b[0]-b[6]*b[2]),a*-(b[5]*b[0]-b[3]*b[2]),a*(b[7]*b[3]-b[6]*b[4]),a*-(b[7]*b[0]-b[6]*b[1]),a*(b[4]*b[0]-b[3]*b[1]))},determinant:function(){var a=this.elements;return a[0]*(a[8]*a[4]-a[7]*a[5])-a[3]*(a[8]*a[1]-a[7]*a[2])+a[6]*(a[5]*a[1]-a[4]*a[2])}},e.prototype.e=d.prototype.e=function(a){return this.elements[a]},f.rmatrix=p,f.defaults={eventNamespace:".panzoom",transition:!0,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,which:1,increment:.3,exponential:!0,panOnlyWhenZoomed:!1,minScale:.3,maxScale:6,rangeStep:.05,duration:200,easing:"ease-in-out",contain:!1},f.prototype={constructor:f,instance:function(){return this},enable:function(){this._initStyle(),this._bind(),this.disabled=!1},disable:function(){this.disabled=!0,this._resetStyle(),this._unbind()},isDisabled:function(){return this.disabled},destroy:function(){this.disable(),a.removeData(this.elem,h)},resetDimensions:function(){this.container=this.parent.getBoundingClientRect();var b=this.elem,c=b.getBoundingClientRect(),d=Math.abs(this.scale);this.dimensions={width:c.width,height:c.height,left:a.css(b,"left",!0)||0,top:a.css(b,"top",!0)||0,border:{top:a.css(b,"borderTopWidth",!0)*d||0,bottom:a.css(b,"borderBottomWidth",!0)*d||0,left:a.css(b,"borderLeftWidth",!0)*d||0,right:a.css(b,"borderRightWidth",!0)*d||0},margin:{top:a.css(b,"marginTop",!0)*d||0,left:a.css(b,"marginLeft",!0)*d||0}}},reset:function(a){a=c(a);var b=this.setMatrix(this._origTransform,a);a.silent||this._trigger("reset",b)},resetZoom:function(a){a=c(a);var b=this.getMatrix(this._origTransform);a.dValue=b[3],this.zoom(b[0],a)},resetPan:function(a){var b=this.getMatrix(this._origTransform);this.pan(b[4],b[5],c(a))},setTransform:function(b){for(var c=this.$set,d=c.length;d--;)a.style(c[d],"transform",b),this.isSVG&&c[d].setAttribute("transform",b)},getTransform:function(b){var c=this.$set,d=c[0];return b?this.setTransform(b):(b=a.style(d,"transform"),!this.isSVG||b&&"none"!==b||(b=a.attr(d,"transform")||"none")),"none"===b||p.test(b)||this.setTransform(b=a.css(d,"transform")),b||"none"},getMatrix:function(a){var b=p.exec(a||this.getTransform());return b&&b.shift(),b||[1,0,0,1,0,0]},setMatrix:function(b,c){if(!this.disabled){c||(c={}),"string"==typeof b&&(b=this.getMatrix(b));var d=+b[0],e="undefined"!=typeof c.contain?c.contain:this.options.contain;if(e){var f=c.dims;f||(this.resetDimensions(),f=this.dimensions);var g,h,i,j=this.container,k=f.width,l=f.height,m=j.width,n=j.height,o=m/k,p=n/l;"center"!==this.$parent.css("textAlign")||"inline"!==a.css(this.elem,"display")?(i=(k-this.elem.offsetWidth)/2,g=i-f.border.left,h=k-m-i+f.border.right):g=h=(k-m)/2;var q=(l-n)/2+f.border.top,r=(l-n)/2-f.border.top-f.border.bottom;"invert"===e||"automatic"===e&&o<1.01?b[4]=Math.max(Math.min(b[4],g-f.border.left),-h):b[4]=Math.min(Math.max(b[4],g),-h),"invert"===e||"automatic"===e&&p<1.01?b[5]=Math.max(Math.min(b[5],q-f.border.top),-r):b[5]=Math.min(Math.max(b[5],q),-r)}if("skip"!==c.animate&&this.transition(!c.animate),c.range&&this.$zoomRange.val(d),this.options.disableXAxis||this.options.disableYAxis){var s=this.getMatrix();this.options.disableXAxis&&(b[4]=s[4]),this.options.disableYAxis&&(b[5]=s[5])}return this.setTransform("matrix("+b.join(",")+")"),this.scale=d,this._checkPanWhenZoomed(d),c.silent||this._trigger("change",b),b}},isPanning:function(){return this.panning},transition:function(b){if(this._transition)for(var c=b||!this.options.transition?"none":this._transition,d=this.$set,e=d.length;e--;)a.style(d[e],"transition")!==c&&a.style(d[e],"transition",c)},pan:function(a,b,c){if(!this.options.disablePan){c||(c={});var d=c.matrix;d||(d=this.getMatrix()),c.relative&&(a+=+d[4],b+=+d[5]),d[4]=a,d[5]=b,this.setMatrix(d,c),c.silent||this._trigger("pan",d[4],d[5])}},zoom:function(b,c){"object"==typeof b?(c=b,b=null):c||(c={});var f=a.extend({},this.options,c);if(!f.disableZoom){var g=!1,h=f.matrix||this.getMatrix(),i=+h[0];"number"!=typeof b&&(b=f.exponential&&i-f.increment>=1?Math[b?"sqrt":"pow"](i,2):i+f.increment*(b?-1:1),g=!0),b>f.maxScale?b=f.maxScale:b<f.minScale&&(b=f.minScale);var j=f.focal;if(j&&!f.disablePan){this.resetDimensions();var k=f.dims=this.dimensions,l=j.clientX,m=j.clientY;this.isSVG||(l-=k.width/i/2,m-=k.height/i/2);var n=new e(l,m,1),o=new d(h),p=this.parentOffset||this.$parent.offset(),q=new d(1,0,p.left-this.$doc.scrollLeft(),0,1,p.top-this.$doc.scrollTop()),r=o.inverse().x(q.inverse().x(n)),s=b/h[0];o=o.x(new d([s,0,0,s,0,0])),n=q.x(o.x(r)),h[4]=+h[4]+(l-n.e(0)),h[5]=+h[5]+(m-n.e(1))}h[0]=b,h[3]="number"==typeof f.dValue?f.dValue:b,this.setMatrix(h,{animate:"undefined"!=typeof f.animate?f.animate:g,range:!f.noSetRange}),f.silent||this._trigger("zoom",h[0],f)}},option:function(b,c){var d;if(!b)return a.extend({},this.options);if("string"==typeof b){if(1===arguments.length)return void 0!==this.options[b]?this.options[b]:null;d={},d[b]=c}else d=b;this._setOptions(d)},_setOptions:function(b){a.each(b,a.proxy(function(b,c){switch(b){case"disablePan":this._resetStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._unbind()}switch(this.options[b]=c,b){case"disablePan":this._initStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":this[b]=c;case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._bind();break;case"cursor":a.style(this.elem,"cursor",c);break;case"minScale":this.$zoomRange.attr("min",c);break;case"maxScale":this.$zoomRange.attr("max",c);break;case"rangeStep":this.$zoomRange.attr("step",c);break;case"startTransform":this._buildTransform();break;case"duration":case"easing":this._buildTransition();case"transition":this.transition();break;case"panOnlyWhenZoomed":this._checkPanWhenZoomed();break;case"$set":c instanceof a&&c.length&&(this.$set=c,this._initStyle(),this._buildTransform())}},this))},_checkPanWhenZoomed:function(a){var b=this.options;if(b.panOnlyWhenZoomed){a||(a=this.getMatrix()[0]);var c=a<=b.minScale;b.disablePan!==c&&this.option("disablePan",c)}},_initStyle:function(){var b={"transform-origin":this.isSVG?"0 0":"50% 50%"};this.options.disablePan||(b.cursor=this.options.cursor),this.$set.css(b);var c=this.$parent;c.length&&!a.nodeName(this.parent,"body")&&(b={overflow:"hidden"},"static"===c.css("position")&&(b.position="relative"),c.css(b))},_resetStyle:function(){this.$elem.css({cursor:"",transition:""}),this.$parent.css({overflow:"",position:""})},_bind:function(){var b=this,c=this.options,d=c.eventNamespace,e="mousedown"+d+" pointerdown"+d+" MSPointerDown"+d,g="touchstart"+d+" "+e,h="touchend"+d+" click"+d+" pointerup"+d+" MSPointerUp"+d,i={},j=this.$reset,l=this.$zoomRange;if(a.each(["Start","Change","Zoom","Pan","End","Reset"],function(){var b=c["on"+this];a.isFunction(b)&&(i["panzoom"+this.toLowerCase()+d]=b)}),c.disablePan&&c.disableZoom||(i[g]=function(a){var d;("touchstart"===a.type?!(d=a.touches||a.originalEvent.touches)||(1!==d.length||c.disablePan)&&2!==d.length:c.disablePan||(a.which||a.originalEvent.which)!==c.which)||(a.preventDefault(),a.stopPropagation(),b._startMove(a,d))},3===c.which&&(i.contextmenu=!1)),this.$elem.on(i),j.length&&j.on(h,function(a){a.preventDefault(),b.reset()}),l.length&&l.attr({step:c.rangeStep===f.defaults.rangeStep&&l.attr("step")||c.rangeStep,min:c.minScale,max:c.maxScale}).prop({value:this.getMatrix()[0]}),!c.disableZoom){var m=this.$zoomIn,n=this.$zoomOut;m.length&&n.length&&(m.on(h,function(a){a.preventDefault(),b.zoom()}),n.on(h,function(a){a.preventDefault(),b.zoom(!0)})),l.length&&(i={},i[e]=function(){b.transition(!0)},i[(k?"input":"change")+d]=function(){b.zoom(+this.value,{noSetRange:!0})},l.on(i))}},_unbind:function(){this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace)},_buildTransform:function(){return this._origTransform=this.getTransform(this.options.startTransform)},_buildTransition:function(){if(this._transform){var a=this.options;this._transition=this._transform+" "+a.duration+"ms "+a.easing}},_getDistance:function(a){var b=a[0],c=a[1];return Math.sqrt(Math.pow(Math.abs(c.clientX-b.clientX),2)+Math.pow(Math.abs(c.clientY-b.clientY),2))},_getMiddle:function(a){var b=a[0],c=a[1];return{clientX:(c.clientX-b.clientX)/2+b.clientX,clientY:(c.clientY-b.clientY)/2+b.clientY}},_trigger:function(a){"string"==typeof a&&(a="panzoom"+a),this.$elem.triggerHandler(a,[this].concat(i.call(arguments,1)))},_startMove:function(c,d){if(!this.panning){var e,f,h,i,j,k,l,m,n=this,o=this.options,p=o.eventNamespace,q=this.getMatrix(),r=q.slice(0),s=+r[4],t=+r[5],u={matrix:q,animate:"skip"},v=c.type;"pointerdown"===v?(e="pointermove",f="pointerup"):"touchstart"===v?(e="touchmove",f="touchend"):"MSPointerDown"===v?(e="MSPointerMove",f="MSPointerUp"):(e="mousemove",f="mouseup"),e+=p,f+=p,this.transition(!0),this.panning=!0,this._trigger("start",c,d);var w=function(a,b){if(b){if(2===b.length){if(null!=h)return;return h=n._getDistance(b),i=+q[0],void(j=n._getMiddle(b))}if(null!=k)return;(m=b[0])&&(k=m.pageX,l=m.pageY)}null==k&&(k=a.pageX,l=a.pageY)};w(c,d);var x=function(a){var b;if(a.preventDefault(),d=a.touches||a.originalEvent.touches,w(a,d),d){if(2===d.length){var c=n._getMiddle(d),e=n._getDistance(d)-h;return n.zoom(e*(o.increment/100)+i,{focal:c,matrix:q,animate:"skip"}),n.pan(+q[4]+c.clientX-j.clientX,+q[5]+c.clientY-j.clientY,u),void(j=c)}b=d[0]||{pageX:0,pageY:0}}b||(b=a),n.pan(s+b.pageX-k,t+b.pageY-l,u)};a(g).off(p).on(e,x).on(f,function(c){c.preventDefault(),a(this).off(p),n.panning=!1,c.type="panzoomend",n._trigger(c,q,!b(q,r))})}}},a.Panzoom=f,a.fn.panzoom=function(b){var c,d,e,g;return"string"==typeof b?(g=[],d=i.call(arguments,1),this.each(function(){c=a.data(this,h),c?"_"!==b.charAt(0)&&"function"==typeof(e=c[b])&&void 0!==(e=e.apply(c,d))&&g.push(e):g.push(void 0)}),g.length?1===g.length?g[0]:g:this):this.each(function(){new f(this,b)})},f});